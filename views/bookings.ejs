<html>
    <head>
        <%- include('partials/header1.ejs') %>
    </head>
    <body>
        <%- include('partials/navbar1.ejs') %>
        <div class="bookings">
            <h2>Book a Hotel Reservation</h2>
            <form method="POST" action="/bookings">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" placeholder="Enter your full name" name="fullName" required><br>
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder="Enter your email" name="email" required><br>
                <label for="mobile">Mobile Number</label>
                <input type="tel" id="mobile" placeholder="Enter your mobile number" name="mobile" required><br>
                
                <label for="checkinDate">Check-in Date</label>
                <input type="date" id="checkinDate" name="checkinDate" required min="<%= new Date().toISOString().split('T')[0] %>" onchange="
                    const checkinDate = new Date(this.value);
                    const today = new Date();
                    if (checkinDate < today) {
                        alert('Check-in date must not be less than today');
                        this.value = '';
                    }
                "><br>
                
                
                
                <label for="checkoutDate">Check-out Date</label>
                <input type="date" id="checkoutDate" name="checkoutDate" required min="<%= new Date().toISOString().split('T')[0] %>" onchange="
                    const checkinDate = new Date(document.getElementById('checkinDate').value);
                    const checkoutDate = new Date(this.value);
                    if (checkoutDate < checkinDate) {
                        alert('Check-out date must not be less than check-in date');
                        this.value = '';
                    }
                "><br>
                
                <label for="numberOfDays">Number of Days</label>
                <input type="number" id="numberOfDays" name="numberOfDays" readonly><br>
                
                <label for="roomType">Room Types</label>
                <select id="roomType" name="roomType" required>
                    <% roomTyps.forEach((roomTyp) => { %>
                    <option value="<%= roomTyp.room_type %>"><%= roomTyp.room_type %></option>
                    <% }); %>
                </select><br>
                <label for="Amount">Amount</label>
                <input type="number" id="Amount" name="Amount" readonly><br>
                <script>
                    document.getElementById('roomType').addEventListener('change', function() {
                        const roomTypeId = this.value;
                        fetch(`/get-room-price/${roomTypeId}`)
                            .then(response => response.json())
                            .then(data => {
                                const roomPrice = data.price;
                                const numberOfDays = document.getElementById('numberOfDays').value;
                                const totalAmount = roomPrice * numberOfDays;
                                document.getElementById('Amount').value = totalAmount;
                            })
                            .catch(error => console.error('Error fetching room price:', error));
                    });

                 /*    document.getElementById('checkoutDate').addEventListener('change', function() {
                        const checkinDate = new Date(document.getElementById('checkinDate').value);
                        const checkoutDate = new Date(this.value);
                        const timeDifference = checkoutDate - checkinDate;
                        const daysDifference = timeDifference / (1000 * 3600 * 24);
                        document.getElementById('numberOfDays').value = daysDifference > 0 ? daysDifference : ''; */
/* 
                    document.getElementById('checkoutDate').addEventListener('change', function() {
                        const daysDifference = calculateDaysDifference(
                            document.getElementById('checkinDate').value,
                            this.value */

                            const checkinDate = new Date(document.getElementById('checkinDate').value);
                    const checkoutDate = new Date(this.value);
                const daysDifference = calculate_days(checkinDate, checkoutDate);
                            document.getElementById('numberOfDays').value = daysDifference;
                        );
                    /*     document.getElementById('numberOfDays').value = daysDifference > 0 ? daysDifference : '';
                        const roomTypeId = document.getElementById('roomType').value;
                        if (roomTypeId) {
                            fetch(`/get-room-price/${roomTypeId}`)
                                .then(response => response.json())
                                .then(data => {
                                    const roomPrice = data.price;
                                    const totalAmount = roomPrice * daysDifference;
                                    document.getElementById('Amount').value = totalAmount;
                                })
                                .catch(error => console.error('Error fetching room price:', error));
                        } */
                        const roomTypeId = document.getElementById('roomType').value;
    const sqlConnection = null; // You may need to modify this to pass the actual SQL connection object
    const totalAmount = calculate_total(daysDifference, sqlConnection, roomTypeId);
    document.getElementById('Amount').value = totalAmount;
  });
                    });
                </script>
                
                <button type="submit">Book Now</button>
            </form>
        </div>
        <script>
            document.getElementById('checkoutDate').addEventListener('change', function() {
                const checkinDate = new Date(document.getElementById('checkinDate').value);
                const checkoutDate = new Date(this.value);
                const timeDifference = checkoutDate - checkinDate;
                const daysDifference = timeDifference / (1000 * 3600 * 24);
                document.getElementById('numberOfDays').value = daysDifference > 0 ? daysDifference : '';
            });
        </script>
    </body>
</html>


